<html
  ><head
    ><title
      >Function START-TARGET-ACTOR</title
    ><meta content="text/html; charset=utf-8" http-equiv="Content-Type"
    /><link href="../style.css" rel="stylesheet"
    /><link title="Print" href="../print.css" rel="alternate stylesheet"
    /></head
  ><body
    ><div class="qbook"
      ><div class="computational-element"
        ><h1
          >Function: START-TARGET-ACTOR</h1
        ><div class="contents"
          ><h2
            >Source</h2
          ><pre
            ><code class="code"
              >(defun start-target-actor (system)
  (setf *targets* (actor-of system
                            :name &quot;*targets*&quot;
                            :receive (lambda (msg)
                                       (let* ((target (cdr msg))
                                              (actor (jsown:val target &quot;actor&quot;))
                                              (delay (jsown:val-safe target &quot;delay&quot;)))
                                         (if (not (get-dest-actor actor))
                                             ;; DEPRECATED Use the producer actor
                                             (progn
                                               (star.rabbit:emit-document  &quot;documents&quot; (format nil &quot;actors.~a.new-target&quot; actor)
                                                                           (jsown:to-json target)
                                                                           :host star:*rabbit-address*
                                                                           :port star:*rabbit-port*
                                                                           :username star:*rabbit-user* :password star:*rabbit-password*)))

                                         (if (and (get-dest-actor actor) (jsown:val target &quot;recurring&quot;) (first-time-p msg))
                                             (wt:schedule-recurring *target-timer* 0.0 delay (lambda ()
                                                                                               (submit-target target nil))
                                                                    (jsown:val target &quot;target&quot;)))
                                         (if (and (get-dest-actor actor) (not (first-time-p msg)))
                                             (route-target target actor)))))))</code
            ></pre
          ><a href="../Starintel_0020Gserver.html#function_005FSTAR.ACTORS_003A_003ASTART-TARGET-ACTOR"
            >Source Context</a
          ></div
        ></div
      ></div
    ></body
  ></html
>